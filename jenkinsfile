pipeline {
    agent any
    environment {
        PATH = "$PATH:/Library/Frameworks/Python.framework/Versions/3.12/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/share/dotnet:~/.dotnet/tools:/Library/Frameworks/Mono.framework/Versions/Current/Commands:/Users/wejdene/Documents/flutter/bin"
    }
    stages {
        stage('Checkout') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'github', url: 'https://github.com/foughali-wejdene/PayeTonKawa.git']]])
            }
        }
         stage('clean') {
                    steps {
                        sh 'flutter clean'
                    }
        }
        stage('Build and Test') {
            steps {
                sh 'flutter pub get'
            }
        }
         stage('test') {
                    steps {
                        sh 'test'
                    }
        }
        stage('dependencies') {
            steps {
                sh 'flutter pub get'
            }
        }
        stage('test') {
            steps {
                dir('lib/'){
                        sh 'flutter test'
                    }
            }
        }

        stage('package') {
                steps {
                    sh 'flutter build apk --release'
                }
        }
        
        stage('Build APK') {
            steps {
                sh 'flutter build apk'
            }
            
            post {
                success {
                    archiveArtifacts artifacts: '**/*.apk', fingerprint: true
                }
            }
        }
    }
}
